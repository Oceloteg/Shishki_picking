# Шишки — экран сборки заказов (прототип)

## Запуск

1) Установите зависимости:

```bash
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate  # Windows PowerShell

pip install -r requirements.txt
```

2) Создайте файл `.env` на основе примера:

```bash
cp .env.example .env
```

3) Укажите пароль входа и секрет:

- `APP_PASSWORD` — пароль для страницы
- `APP_SECRET_KEY` — длинная случайная строка

4) Запуск сервера:

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

5) Откройте в браузере:

- http://localhost:8000

## Режимы интеграции с 1С

По умолчанию проект запускается в режиме `ONEC_MODE=mock` и использует тестовые данные из
`app/onec/mock_data.json`.

Реальную интеграцию с 1С:Фреш (OData/HTTP) подключаем после прототипа: поля и endpoints
нужно будет посмотреть на боевой базе и заполнить в `app/onec/client.py` (класс `ODataOneCClient`).

## Важно

- Прогресс сборки хранится в локальной БД приложения (SQLite/PostgreSQL).
- Синхронизация в 1С реализована как "best effort" через очередь `sync_queue`:
  если 1С недоступна, изменения не теряются и будут повторяться.


## Синхронизация

- После входа UI автоматически вызывает `/api/sync-now` (загрузка заказов из 1С + обработка очереди синхронизации).
- В интерфейсе есть кнопка **Обновить** для принудительной синхронизации.
